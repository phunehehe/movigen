#!/bin/bash

set -e


cd "$(dirname "$0")"

while read -d $'\0' file
do
    thumbnail="${file}.jpg"
    [[ -f "$thumbnail" ]] || ffmpeg -itsoffset -120 \
                                    -i "$file" \
                                    -vframes 1 \
                                    -vf 'scale=-1:400' \
                                    "$thumbnail" < /dev/null

done < <(find -L \
              -type f \
              -regextype posix-extended \
              -regex '.*\.(mkv|mp4|avi)' \
              -print0 | sort -z)
